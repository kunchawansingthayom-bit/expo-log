<!DOCTYPE html>
<html lang="th" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>expo&log — Neo Sci-Fi Challenge</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
<style>
:root{--bg:#02030a;--panel:#061025;--muted:#9fb4d1;--accent:#00e6ff;--gold:#ffd166;--glass:rgba(255,255,255,0.03);--neon:0 0 20px rgba(0,230,255,0.14);--glow:0 8px 40px rgba(0,230,255,0.06)}
html[data-theme="light"]{--bg:#f6fbff;--panel:#ffffff;--muted:#2b3a55;--accent:#0057ff;--gold:#b8860b;--glass:rgba(0,0,0,0.04)}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:
radial-gradient(900px 400px at 10% 8%, rgba(0,60,120,0.06), transparent 8%),
linear-gradient(180deg,var(--bg),#001427 60%);font-family:Inter, 'Sarabun', system-ui, -apple-system, 'Segoe UI', Roboto;color:var(--muted);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
canvas#neb{position:fixed;left:0;top:0;width:100%;height:100%;z-index:0}
.app{position:relative;z-index:2;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
.shell{width:96%;max-width:1280px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(0,230,255,0.06);backdrop-filter:blur(10px);border-radius:14px;box-shadow:var(--neon);overflow:hidden;display:grid;grid-template-columns:320px 1fr;gap:20px}
header.topbar{grid-column:1/3;padding:18px 24px;border-bottom:1px solid rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:60px;height:60px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--gold));display:flex;align-items:center;justify-content:center;color:#021223;font-weight:900;font-size:20px;box-shadow:0 8px 40px rgba(0,230,255,0.12)}
h1.title{margin:0;font-size:1.15rem;color:var(--gold);letter-spacing:0.6px}
p.subtitle{margin:0;color:rgba(255,255,255,0.64);font-size:0.86rem}
.controls{display:flex;align-items:center;gap:10px}
.toggle{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:10px;color:var(--muted);cursor:pointer;display:inline-flex;align-items:center;gap:8px}
.toggle:active{transform:translateY(1px)}
.sidebar{padding:18px;background:linear-gradient(180deg,rgba(0,0,0,0.03),transparent);border-right:1px solid rgba(255,255,255,0.02)}
.profile{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.avatar{width:56px;height:56px;border-radius:10px;background:linear-gradient(180deg,#001b2e,#00314a);display:flex;align-items:center;justify-content:center;color:var(--accent);font-weight:800;font-size:18px;box-shadow:0 8px 30px rgba(0,0,0,0.3)}
.meta{display:flex;flex-direction:column}
.meta .name{color:var(--gold);font-weight:800}
.meta .level{font-size:0.86rem;color:rgba(255,255,255,0.58)}
nav.menu{display:flex;flex-direction:column;gap:10px;margin-top:8px}
button.menu-btn{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;border:1px solid transparent;background:linear-gradient(90deg,transparent,transparent);color:var(--muted);cursor:pointer;justify-content:space-between}
button.menu-btn.active{background:linear-gradient(90deg,rgba(0,230,255,0.06),rgba(255,209,102,0.03));border:1px solid rgba(0,230,255,0.08);box-shadow:var(--neon);color:var(--gold)}
.mode-pills{display:flex;gap:8px;margin-top:14px}
.pill{padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);cursor:pointer}
.sidebar .panel{margin-top:18px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.02)}
.main{padding:18px;display:flex;flex-direction:column;gap:14px}
.panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.04));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.02)}
.overview{display:flex;gap:12px;align-items:center}
.stat{padding:10px;border-radius:10px;background:linear-gradient(90deg,rgba(0,230,255,0.03),transparent);min-width:120px;text-align:center}
.stat .num{font-size:1.15rem;color:var(--accent);font-weight:800}
.board{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.card{padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:transform .18s,box-shadow .18s}
.card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(0,0,0,0.5)}
.card h3{margin:0;color:var(--gold);font-size:0.95rem}
.card p{margin:8px 0 0;font-size:0.88rem;color:rgba(255,255,255,0.7)}
.content-area{display:flex;flex-direction:column;gap:12px}
.problem-card{padding:16px;border-radius:12px;background:linear-gradient(180deg,rgba(0,0,0,0.04),rgba(0,0,0,0.02));border:1px solid rgba(0,230,255,0.04)}
.problem-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.problem-title{font-weight:800;color:var(--accent)}
.problem-body{margin-top:12px;color:rgba(255,255,255,0.92);font-size:1rem;line-height:1.45}
.actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.btn{padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--gold));color:#021223;border:none;box-shadow:0 12px 36px rgba(0,230,255,0.08)}
.input{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);width:100%}
.solution-placeholder{height:180px;border-radius:8px;border:2px dashed rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,0.16);margin-top:12px}
.solution-img{max-width:100%;max-height:240px;border-radius:8px}
.test-footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.timer{font-weight:900;color:var(--accent)}
.score{font-weight:900;color:var(--gold)}
.overlay{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;z-index:9}
.modal{width:560px;background:linear-gradient(180deg,#031428,#071a2e);border-radius:12px;padding:18px;border:1px solid rgba(0,230,255,0.06);box-shadow:var(--neon)}
.modal h2{margin:0;color:var(--gold)}
.footerbar{grid-column:1/3;padding:12px 20px;border-top:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
.katex-display{background:transparent}
@media(max-width:1000px){.shell{grid-template-columns:1fr}.sidebar{order:2}.main{order:1}.board{grid-template-columns:repeat(2,1fr)}}
@media(max-width:640px){.board{grid-template-columns:1fr}}
.fade-in{animation:fadeIn .45s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.neon-border{box-shadow:0 0 18px rgba(0,230,255,0.12),inset 0 0 40px rgba(0,230,255,0.02)}
.progress-bar{height:10px;border-radius:999px;background:linear-gradient(90deg,rgba(255,255,255,0.03),transparent);overflow:hidden}
.progress-bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--gold));width:0%}
.small{font-size:0.85rem;color:rgba(255,255,255,0.65)}
.tag{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);font-size:0.78rem;color:var(--muted)}
.hint{font-size:0.9rem;color:rgba(255,255,255,0.6);margin-top:8px}
</style>
</head>
<body>
<canvas id="neb" aria-hidden="true"></canvas>
<div class="app">
  <div class="shell" role="application" aria-label="expo&log challenge">
    <header class="topbar">
      <div class="brand">
        <div class="logo">e&l</div>
        <div>
          <h1 class="title" id="mainTitle">expo&log</h1>
          <p class="subtitle" id="subline">Neo Sci-Fi Exponential & Logarithm Arena</p>
        </div>
      </div>
      <div class="controls">
        <button id="musicToggle" class="toggle" aria-pressed="false">🔊</button>
        <button id="langToggle" class="toggle">TH / EN</button>
        <button id="themeToggle" class="toggle">Theme</button>
        <button id="openSettings" class="toggle">⚙</button>
      </div>
    </header>

    <aside class="sidebar" aria-label="sidebar">
      <div class="profile">
        <div class="avatar">EL</div>
        <div class="meta">
          <div class="name" id="playerName">Player</div>
          <div class="level" id="playerLevel">Practice</div>
        </div>
      </div>

      <nav class="menu" role="navigation" aria-label="main menu">
        <button class="menu-btn active" data-view="learn">Learn</button>
        <button class="menu-btn" data-view="test">Test</button>
        <button class="menu-btn" data-view="challenge">Challenge</button>
        <button class="menu-btn" data-view="bank">Problem Bank</button>
      </nav>

      <div class="mode-pills">
        <button class="pill" id="shuffleBtn">Shuffle</button>
        <button class="pill" id="resetScore">Reset Score</button>
      </div>

      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Progress</div>
            <div class="num" id="progressVal">0 / 30</div>
          </div>
          <div style="width:60%">
            <div class="progress-bar" aria-hidden="true"><i id="progressInner" style="width:0%"></i></div>
          </div>
        </div>
      </div>

      <div class="panel" style="margin-top:12px">
        <div class="small">Best Score</div>
        <div class="num" id="bestScore">0</div>
      </div>

    </aside>

    <main class="main" id="main">

      <section class="panel overview">
        <div style="flex:1">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
            <div>
              <h2 id="viewTitle" style="margin:0;color:var(--gold)">Welcome to expo&log Arena</h2>
              <div id="viewSubtitle" style="color:rgba(255,255,255,0.6);font-size:0.9rem;margin-top:6px">Practice exponential and logarithmic problems at olympiad level</div>
            </div>
            <div style="text-align:right">
              <div class="small">Mode</div>
              <div class="score" id="currentMode">Learn</div>
            </div>
          </div>
        </div>
      </section>

      <section class="panel content-area" id="contentArea">
        <div class="board" id="learnBoard"></div>

        <div id="contentPlaceholder" class="fade-in">
          <div class="problem-card">
            <div class="problem-header">
              <div>
                <div class="problem-title" id="probTitle">เลือกโจทย์เพื่อเริ่ม</div>
                <div class="small" id="probSub">มีทั้งหมด 30 โจทย์ระดับ สอวน.</div>
              </div>
              <div>
                <div class="small">Time</div>
                <div class="timer" id="globalTimer">00:00</div>
              </div>
            </div>
            <div class="problem-body" id="probBody" style="min-height:120px">กดการ์ดทางซ้ายเพื่อดูโจทย์ หรือกด Start Test เพื่อทดสอบความสามารถ</div>
            <div class="actions">
              <button class="btn primary" id="startTest">Start Test</button>
              <button class="btn" id="nextProb">Next</button>
              <button class="btn" id="showSolutionBtn">Show solution (placeholder)</button>
              <div style="flex:1"></div>
              <div style="display:flex;gap:8px;align-items:center">
                <div class="small">Language</div>
                <div id="langLabel" class="tag">TH</div>
              </div>
            </div>
            <div class="solution-placeholder" id="solutionArea">Solution image placeholder</div>
          </div>
        </div>

      </section>

      <section class="panel" id="testPanel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800;color:var(--accent)" id="testTitle">Test Mode</div>
          <div style="display:flex;gap:12px;align-items:center">
            <div class="timer" id="testTimer">00:00</div>
            <div class="score" id="testScore">Score: 0</div>
          </div>
        </div>
        <div style="margin-top:12px" id="testArea"></div>
        <div class="test-footer">
          <div>
            <button class="btn primary" id="submitAnswer">Submit</button>
            <button class="btn" id="skip">Skip</button>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <div class="small">Highscore</div>
            <div class="score" id="highScore">0</div>
          </div>
        </div>
      </section>

      <section class="panel" id="bankPanel" style="display:none">
        <h3 style="margin:0;color:var(--gold)">Problem Bank</h3>
        <div id="bankList" style="margin-top:12px;display:grid;grid-template-columns:repeat(2,1fr);gap:10px"></div>
      </section>

    </main>

    <div class="footerbar">
      <div class="small">expo&log — Neo Sci-Fi Challenge</div>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="small">30 Problems</div>
        <div class="small">Made for training</div>
      </div>
    </div>

  </div>
</div>

<div class="overlay" id="modalOverlay">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h2 id="modalTitle">Settings</h2>
    <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
      <div style="display:flex;gap:8px;align-items:center">
        <label style="min-width:110px;color:rgba(255,255,255,0.6)">Player name</label>
        <input id="playerNameInput" class="input" placeholder="Player" />
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <label style="min-width:110px;color:rgba(255,255,255,0.6)">Language</label>
        <select id="langSelect" class="input"><option value="th">ไทย</option><option value="en">English</option></select>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <label style="min-width:110px;color:rgba(255,255,255,0.6)">Test length</label>
        <select id="testLen" class="input"><option value="5">5</option><option value="10" selected>10</option><option value="15">15</option></select>
      </div>
      <div style="display:flex;justify-content:flex-end;margin-top:12px;gap:8px">
        <button class="btn" id="closeModal">Close</button>
        <button class="btn primary" id="saveModal">Save</button>
      </div>
    </div>
  </div>
</div>

<script>
const canvas=document.getElementById('neb');const ctx=canvas.getContext('2d');function resize(){canvas.width=innerWidth;canvas.height=innerHeight}resize();addEventListener('resize',resize);class Particle{constructor(){this.reset()}reset(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.r=0.6+Math.random()*1.8;this.vx=(Math.random()-0.5)*0.4;this.vy=(Math.random()-0.5)*0.4;this.alpha=0.08+Math.random()*0.6}update(){this.x+=this.vx;this.y+=this.vy;if(this.x<0)this.x=canvas.width;if(this.x>canvas.width)this.x=0;if(this.y<0)this.y=canvas.height;if(this.y>canvas.height)this.y=0}draw(){ctx.beginPath();ctx.fillStyle='rgba(0,230,255,'+this.alpha+')';ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fill();ctx.closePath()}}const parts=[];for(let i=0;i<280;i++)parts.push(new Particle());function renderParticles(){ctx.clearRect(0,0,canvas.width,canvas.height);for(const p of parts){p.update();p.draw()}connect();requestAnimationFrame(renderParticles)}function connect(){const max=110;for(let a=0;a<parts.length;a++){for(let b=a+1;b<parts.length;b++){const dx=parts[a].x-parts[b].x;const dy=parts[a].y-parts[b].y;const d=Math.sqrt(dx*dx+dy*dy);if(d<max){ctx.strokeStyle='rgba(0,230,255,'+(1-(d/max))*0.08+')';ctx.lineWidth=0.55;ctx.beginPath();ctx.moveTo(parts[a].x,parts[a].y);ctx.lineTo(parts[b].x,parts[b].y);ctx.stroke();ctx.closePath()}}}}renderParticles();

const problems=[
{id:1,topic:'expo-equation',level:'hard',title:{th:'โจทย์ 1: สมการชักยก',en:'Problem 1: Exponential equation'},body:{th:'จงแก้สมการ \\(2^{x+1}+2^{x}-3\\cdot2^{1-x}=0\\) สำหรับ x เป็นจำนวนจริง',en:'Solve for real x: \\(2^{x+1}+2^{x}-3\\cdot2^{1-x}=0\\)'},solution:{placeholder:true}},
{id:2,topic:'expo-equation',level:'hard',title:{th:'โจทย์ 2: สมการยกกำลัง',en:'Problem 2: Power equation'},body:{th:'\\(3^{2x}-10\\cdot3^{x}+9=0\\) จงหาค่า x',en:'Find x: \\(3^{2x}-10\\cdot3^{x}+9=0\\)'},solution:{placeholder:true}},
{id:3,topic:'log-equation',level:'hard',title:{th:'โจทย์ 3: สมการลอการิทึม',en:'Problem 3: Logarithmic equation'},body:{th:'\\(\\log_2(x+3)+\\log_2(x-1)=3\\) จงหาค่า x',en:'Solve: \\(\\log_2(x+3)+\\log_2(x-1)=3\\)'},solution:{placeholder:true}},
{id:4,topic:'log-inequal',level:'hard',title:{th:'โจทย์ 4: อสมการลอการิทึม',en:'Problem 4: Logarithmic inequality'},body:{th:'\\(\\log_{3}(x-1)<2-\\log_3(2x-5)\\) จงหาช่วงของ x',en:'Find x: \\(\\log_{3}(x-1)<2-\\log_3(2x-5)\\)'},solution:{placeholder:true}},
{id:5,topic:'expo-inequal',level:'hard',title:{th:'โจทย์ 5: อสมการเอ็กซ์โป',en:'Problem 5: Exponential inequality'},body:{th:'\\(2^{2x}-5\\cdot2^{x}+6<0\\) แก้หาช่วงของ x',en:'Solve: \\(2^{2x}-5\\cdot2^{x}+6<0\\)'},solution:{placeholder:true}},
{id:6,topic:'graph',level:'hard',title:{th:'โจทย์ 6: แปลงกราฟ',en:'Problem 6: Graph transformation'},body:{th:'ฟังก์ชัน \\(y=\\log_2(x+3)+2\\) มาจากการแปลงของ \\(y=\\log_2 x\\) อย่างไรระบุการเลื่อนและการยืด/ย่อ',en:'Describe transformations from \\(y=\\log_2 x\\) to \\(y=\\log_2(x+3)+2\\)'},solution:{placeholder:true}},
{id:7,topic:'combo',level:'hard',title:{th:'โจทย์ 7: ผสมสมบัติ',en:'Problem 7: Mixed properties'},body:{th:'\\(\\log_a(x-1)+\\log_a(x+1)=2\\) โดย a>0,a\\ne1, จงหาช่วงของ x',en:'Given \\(\\log_a(x-1)+\\log_a(x+1)=2\\) with a>0,a\\ne1, find x-range'},solution:{placeholder:true}},
{id:8,topic:'expo-log',level:'hard',title:{th:'โจทย์ 8: สมการผสม',en:'Problem 8: Mixed equation'},body:{th:'\\(e^{2x}-5e^{x}+6=0\\) จงหาค่า x',en:'Solve: \\(e^{2x}-5e^{x}+6=0\\)'},solution:{placeholder:true}},
{id:9,topic:'log-properties',level:'hard',title:{th:'โจทย์ 9: ใช้สมบัติ',en:'Problem 9: Use properties'},body:{th:'จาก \\(\\log_5(x)+\\log_5(x-4)=2\\) จงหาค่า x',en:'Given \\(\\log_5(x)+\\log_5(x-4)=2\\), find x'},solution:{placeholder:true}},
{id:10,topic:'system',level:'hard',title:{th:'โจทย์ 10: ระบบสมการ',en:'Problem 10: System of equations'},body:{th:'แก้ระบบ \\(\\begin{cases}2^{x}+3^{y}=35\\\\2^{x+1}+3^{y+1}=112\\end{cases}\\)',en:'Solve system \\(2^{x}+3^{y}=35, 2^{x+1}+3^{y+1}=112\\)'},solution:{placeholder:true}},
{id:11,topic:'expo-equation',level:'hard',title:{th:'โจทย์ 11: สมการย้อนกลับ',en:'Problem 11: Inverse style'},body:{th:'หา x ที่ทำให้ \\(4^{x}+4^{1-x}=5\\)',en:'Find x: \\(4^{x}+4^{1-x}=5\\)'},solution:{placeholder:true}},
{id:12,topic:'log-equation',level:'hard',title:{th:'โจทย์ 12: สมการโลการิทึมผสม',en:'Problem 12: Mixed log equation'},body:{th:'\\(\\log(x)+\\log(2x)=\\log(9)\\) จงหาค่า x, x>0',en:'Solve: \\(\\log(x)+\\log(2x)=\\log(9)\\) for x>0'},solution:{placeholder:true}},
{id:13,topic:'inequal',level:'hard',title:{th:'โจทย์ 13: อสมการผสม',en:'Problem 13: Mixed inequality'},body:{th:'\\(\\log_2(x)+x<4\\) หา x',en:'Solve: \\(\\log_2(x)+x<4\\)'},solution:{placeholder:true}},
{id:14,topic:'graph',level:'hard',title:{th:'โจทย์ 14: จุดตัดกราฟ',en:'Problem 14: Graph intersection'},body:{th:'กราฟของ \\(y=2^x\\) และ \\(y=3^{x-1}\\) ตัดกันที่จุดใด',en:'Find intersection of \\(y=2^x\\) and \\(y=3^{x-1}\\)'},solution:{placeholder:true}},
{id:15,topic:'expo-log',level:'hard',title:{th:'โจทย์ 15: สมการผสมลอการิทึมและเอ็กซ์โป',en:'Problem 15: Exponential-log mixed'},body:{th:'\\(\\log_2(3^{x})=2x-1\\) หา x',en:'Solve: \\(\\log_2(3^{x})=2x-1\\)'},solution:{placeholder:true}},
{id:16,topic:'advanced',level:'hard',title:{th:'โจทย์ 16: เทคนิค substitution',en:'Problem 16: Substitution technique'},body:{th:'แก้ \\(2^{2x}+2^{x+1}-2=0\\)',en:'Solve: \\(2^{2x}+2^{x+1}-2=0\\)'},solution:{placeholder:true}},
{id:17,topic:'log-equation',level:'hard',title:{th:'โจทย์ 17: ฐานไม่เป็นมาตรฐาน',en:'Problem 17: Nonstandard base'},body:{th:'\\(\\log_{\\frac{1}{3}}(x)=2\\) หา x',en:'Find x: \\(\\log_{1/3}(x)=2\\)'},solution:{placeholder:true}},
{id:18,topic:'inequal',level:'hard',title:{th:'โจทย์ 18: อสมการยาก',en:'Problem 18: Hard inequality'},body:{th:'\\(\\frac{1}{2}\\log(x)+\\log(4x)\\ge3\\) หาช่วง x>0',en:'Solve: \\(\\tfrac{1}{2}\\log(x)+\\log(4x)\\ge3\\) for x>0'},solution:{placeholder:true}},
{id:19,topic:'combo',level:'hard',title:{th:'โจทย์ 19: สมการเชิงตรรกะ',en:'Problem 19: Logical exponential'},body:{th:'ให้ \\(2^{x}+2^{y}=5\\) และ \\(x+y=2\\) จงหา x,y',en:'Given \\(2^{x}+2^{y}=5\\) and x+y=2, find x,y'},solution:{placeholder:true}},
{id:20,topic:'graph',level:'hard',title:{th:'โจทย์ 20: ลักษณะกราฟ',en:'Problem 20: Graph nature'},body:{th:'ฟังก์ชัน \\(y=\\log(x^2-4)\\) มี domain เป็นเท่าใด',en:'Find the domain of \\(y=\\log(x^2-4)\\)'},solution:{placeholder:true}},
{id:21,topic:'expo-equation',level:'hard',title:{th:'โจทย์ 21: สมการเอกซ์โปผสม',en:'Problem 21: Mixed expo equation'},body:{th:'\\(5^{x}+5^{1-x}=6\\) จงหาค่า x',en:'Solve: \\(5^{x}+5^{1-x}=6\\)'},solution:{placeholder:true}},
{id:22,topic:'log-properties',level:'hard',title:{th:'โจทย์ 22: สมบัติของลอการิทึม',en:'Problem 22: Log properties'},body:{th:'พิสูจน์ว่า \\(\\log_a(b)\\log_b(c)\\log_c(a)=1\\) เมื่อตัวแปรเป็นไปตามข้อกำหนด',en:'Show that \\(\\log_a(b)\\log_b(c)\\log_c(a)=1\\)'},solution:{placeholder:true}},
{id:23,topic:'system',level:'hard',title:{th:'โจทย์ 23: ระบบสมการลอการิทึม',en:'Problem 23: Log system'},body:{th:'แก้ \\(\\begin{cases}\\log(x)+\\log(y)=3\\\\\\log(x)-\\log(y)=1\\end{cases}\\)',en:'Solve system \\(\\log(x)+\\log(y)=3, \\log(x)-\\log(y)=1\\)'},solution:{placeholder:true}},
{id:24,topic:'advanced',level:'hard',title:{th:'โจทย์ 24: สมการผสมฐาน',en:'Problem 24: Mixed bases'},body:{th:'\\(2^{x}=3^{y}\\) และ \\(x+y=5\\) จงหา x,y',en:'Given \\(2^{x}=3^{y}\\) and x+y=5, find x,y'},solution:{placeholder:true}},
{id:25,topic:'inequal',level:'hard',title:{th:'โจทย์ 25: อสมการแปลก',en:'Problem 25: Strange inequality'},body:{th:'\\(\\log_2(x+1)-\\log_2(x-1)>1\\) หา x',en:'Solve: \\(\\log_2(x+1)-\\log_2(x-1)>1\\)'},solution:{placeholder:true}},
{id:26,topic:'graph',level:'hard',title:{th:'โจทย์ 26: วิเคราะห์กราฟ',en:'Problem 26: Analyze graph'},body:{th:'จงหาจุดที่ \\(y=\\log_{10}x\\) มีความชันเท่ากับ 0.1',en:'Find x where derivative of \\(y=\\log_{10}x\\) equals 0.1'},solution:{placeholder:true}},
{id:27,topic:'expo-log',level:'hard',title:{th:'โจทย์ 27: สมการผสมเชิงลอการิทึม',en:'Problem 27: Log-expo mix'},body:{th:'\\(\\log(x)+x=4\\) หา x',en:'Solve: \\(\\log(x)+x=4\\)'},solution:{placeholder:true}},
{id:28,topic:'advanced',level:'hard',title:{th:'โจทย์ 28: เทคนิคขั้นสูง',en:'Problem 28: Advanced trick'},body:{th:'\\(\\sqrt{e^{2x}+1}-e^{x}=1\\) หา x',en:'Solve: \\(\\sqrt{e^{2x}+1}-e^{x}=1\\)'},solution:{placeholder:true}},
{id:29,topic:'combo',level:'hard',title:{th:'โจทย์ 29: รวมสมบัติ',en:'Problem 29: Combine properties'},body:{th:'\\(\\log_2(4x)-\\log_2(x)=3\\) หา x',en:'Solve: \\(\\log_2(4x)-\\log_2(x)=3\\)'},solution:{placeholder:true}},
{id:30,topic:'final',level:'hard',title:{th:'โจทย์ 30: Final Boss',en:'Problem 30: Final Boss'},body:{th:'จงแก้ \\(\\log_2(x)+\\log_4(x)=\\dfrac{5}{2}\\) สำหรับ x>0',en:'Solve: \\(\\log_2(x)+\\log_4(x)=\\dfrac{5}{2}\\) for x>0'},solution:{placeholder:true}}
];

const state={lang:localStorage.getItem('el_lang')||'th',view:'learn',index:0,order:problems.map(p=>p.id),score:0,high:localStorage.getItem('el_high')?Number(localStorage.getItem('el_high')):0,currentSet:[],testIndex:0,testTimer:null,globalStart:Date.now()};
function formatTime(s){const m=Math.floor(s/60).toString().padStart(2,'0');const sec=(s%60).toString().padStart(2,'0');return m+':'+sec}
function renderMenu(){document.querySelectorAll('.menu-btn').forEach(b=>b.classList.remove('active'));document.querySelector(`.menu-btn[data-view="${state.view}"]`)?.classList.add('active');document.getElementById('currentMode').textContent=state.view.charAt(0).toUpperCase()+state.view.slice(1)}
function ensureMathDelimiters(e){if(!e)return'';if(/\$\$|\\\[|\\\(|\$/g.test(e))return e;return `$$${e}$$`}

function renderLearnBoard(){
  const board=document.getElementById('learnBoard');board.innerHTML='';
  for(const p of problems){
    const card=document.createElement('div');card.className='card fade-in';
    card.tabIndex=0;
    const h=document.createElement('h3');h.textContent=p.title[state.lang];
    const d=document.createElement('p');d.innerHTML=truncateLatex(p.body[state.lang],140);
    const tags=document.createElement('div');tags.style.marginTop='8px';
    const t1=document.createElement('span');t1.className='tag';t1.textContent=p.topic;tags.appendChild(t1);
    card.appendChild(h);card.appendChild(d);card.appendChild(tags);
    card.addEventListener('click',()=>openProblem(p.id));
    card.addEventListener('keydown',e=>{if(e.key==='Enter')openProblem(p.id)});
    board.appendChild(card);
  }
}

function truncateLatex(s,n){
  const t=s.replace(/\\\(|\\\)|\$\$|\\\[|\\\]/g,'');
  if(t.length<=n) return t;
  return t.slice(0,n-2)+'...';
}

function openProblem(id){
  const p=problems.find(x=>x.id===id);if(!p)return;
  document.getElementById('probTitle').textContent=p.title[state.lang];
  document.getElementById('probSub').textContent=(state.lang==='th'?'ระดับ':'Level')+' • '+p.level;
  document.getElementById('probBody').innerHTML=ensureMathDelimiters(p.body[state.lang]);
  renderMathInElement(document.getElementById('probBody'),{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\(',right:'\\)',display:false},{left:'\\[',right:'\\]',display:true}]});
  document.getElementById('solutionArea').innerHTML=p.solution.placeholder?'<div style="color:rgba(255,255,255,0.12)">Solution image placeholder</div>':'<img class="solution-img" src="'+p.solution.src+'">';
  state.index=problems.findIndex(x=>x.id===id);
  updateProgress();
}

function renderBank(){
  const bank=document.getElementById('bankList');bank.innerHTML='';
  for(const p of problems){
    const div=document.createElement('div');div.className='card';
    const title=document.createElement('div');title.style.fontWeight=700;title.style.color='var(--accent)';title.textContent=p.title[state.lang];
    const body=document.createElement('div');body.style.marginTop='6px';body.style.color='rgba(255,255,255,0.75)';body.textContent=p.body[state.lang].replace(/\\\(|\\\)|\$\$|\\\[|\\\]/g,'');
    const btn=document.createElement('button');btn.className='btn';btn.textContent=state.lang==='th'?'เปิด':'Open';btn.addEventListener('click',()=>openProblem(p.id));
    div.appendChild(title);div.appendChild(body);div.appendChild(btn);bank.appendChild(div);
  }
}

function renderView(){
  renderMenu();
  document.getElementById('viewTitle').textContent=state.view==='learn'?(state.lang==='th'?'เรียนรู้':'Learn'):(state.view==='test'?(state.lang==='th'?'ทดสอบ':'Test Mode'):(state.view==='challenge'?(state.lang==='th'?'ท้า':'Challenge'):(state.lang==='th'?'คลังโจทย์':'Problem Bank')));
  document.getElementById('contentArea').style.display=state.view==='learn'?'block':'none';
  document.getElementById('testPanel').style.display=state.view==='test'?'block':'none';
  document.getElementById('bankPanel').style.display=state.view==='bank'?'block':'none';
  if(state.view==='learn')renderLearnBoard();
  if(state.view==='bank')renderBank();
  document.getElementById('langLabel').textContent=state.lang==='th'?'TH':'EN';
}

function renderAll(){document.getElementById('subline').textContent=state.lang==='th'?'สนามประลองเอ็กซ์โปและลอการิทึม':'Neo Sci-Fi Exponential & Logarithm Arena';renderView();renderLearnBoard();document.getElementById('bestScore').textContent=state.high}

function bindUI(){
  document.querySelectorAll('.menu-btn').forEach(b=>b.addEventListener('click',e=>{state.view=b.dataset.view;renderView()}));
  document.getElementById('langToggle').addEventListener('click',()=>{state.lang=state.lang==='th'?'en':'th';localStorage.setItem('el_lang',state.lang);renderAll()});
  document.getElementById('themeToggle').addEventListener('click',()=>{document.documentElement.classList.toggle('light')});
  document.getElementById('shuffleBtn').addEventListener('click',()=>{state.order=shuffleArray(state.order);renderLearnBoard()});
  document.getElementById('startTest').addEventListener('click',()=>startTest());
  document.getElementById('nextProb').addEventListener('click',()=>{const next=(state.index+1)%problems.length;openProblem(state.order[next])});
  document.getElementById('showSolutionBtn').addEventListener('click',()=>{document.getElementById('solutionArea').innerHTML='<div style="color:rgba(255,255,255,0.12)">Solution image placeholder</div>'});
  document.getElementById('musicToggle').addEventListener('click',()=>{const v=document.getElementById('musicToggle');const pressed=v.getAttribute('aria-pressed')==='true';v.setAttribute('aria-pressed',(!pressed).toString());v.textContent=pressed?'🔊':'🔈'});
  document.getElementById('resetScore').addEventListener('click',()=>{state.score=0;state.high=0;localStorage.setItem('el_high','0');document.getElementById('highScore').textContent=0;document.getElementById('bestScore').textContent=0});
  document.getElementById('openSettings').addEventListener('click',()=>{document.getElementById('modalOverlay').style.display='flex';document.getElementById('playerNameInput').value=document.getElementById('playerName').textContent;document.getElementById('langSelect').value=state.lang;document.getElementById('testLen').value=10});
  document.getElementById('closeModal').addEventListener('click',()=>{document.getElementById('modalOverlay').style.display='none'});
  document.getElementById('saveModal').addEventListener('click',()=>{const name=document.getElementById('playerNameInput').value||'Player';document.getElementById('playerName').textContent=name;state.lang=document.getElementById('langSelect').value;localStorage.setItem('el_lang',state.lang);document.getElementById('modalOverlay').style.display='none';renderAll()});
  document.getElementById('submitAnswer').addEventListener('click',submitAnswer);
  document.getElementById('skip').addEventListener('click',()=>{state.testIndex++;if(state.testIndex>=state.currentSet.length){endTest()}else{showTestQuestion()}});
  document.addEventListener('keydown',e=>{if(e.key==='ArrowRight'){const next=(state.index+1)%problems.length;openProblem(state.order[next])}else if(e.key==='ArrowLeft'){const prev=(state.index-1+problems.length)%problems.length;openProblem(state.order[prev])}});
}

function startTest(){
  const n=Number(document.getElementById('testLen').value||10);
  state.currentSet=pickRandom(problems,n);
  state.score=0;
  document.getElementById('testScore').textContent='Score: 0';
  document.getElementById('highScore').textContent=state.high;
  state.testIndex=0;
  state.view='test';
  renderView();
  showTestQuestion();
  startTestTimer(60*n);
}

function showTestQuestion(){
  const q=state.currentSet[state.testIndex];
  document.getElementById('testArea').innerHTML='';
  const card=document.createElement('div');card.className='problem-card';
  const header=document.createElement('div');header.className='problem-header';
  const left=document.createElement('div');left.innerHTML='<div class="problem-title">'+q.title[state.lang]+'</div><div class="small" style="margin-top:6px">'+(state.lang==='th'?'โจทย์':'Problem')+' '+(state.testIndex+1)+'</div>';
  header.appendChild(left);
  card.appendChild(header);
  const body=document.createElement('div');body.className='problem-body';body.innerHTML=ensureMathDelimiters(q.body[state.lang]);
  renderMathInElement(body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\(',right:'\\)',display:false},{left:'\\[',right:'\\]',display:true}]});
  card.appendChild(body);
  const input=document.createElement('input');input.className='input';input.placeholder=state.lang==='th'?'พิมพ์คำตอบที่นี่':'Type answer here';
  card.appendChild(input);
  const hint=document.createElement('div');hint.className='hint';hint.textContent=state.lang==='th'?'ตอบเป็นตัวเลขหรือนิพจน์ย่อได้':'Answer as number or simplified expression';
  card.appendChild(hint);
  document.getElementById('testArea').appendChild(card);
}

function submitAnswer(){
  const q=state.currentSet[state.testIndex];
  const input=document.querySelector('#testArea .input');
  const ans=input.value.trim();
  let correct=false;
  try{correct=validateAnswer(q,ans)}catch(e){correct=false}
  if(correct){state.score+=10;flash(true)}else{flash(false)}
  document.getElementById('testScore').textContent='Score: '+state.score;
  state.testIndex++;
  if(state.testIndex>=state.currentSet.length){endTest()}else{showTestQuestion()}
}

function endTest(){
  stopTestTimer();
  if(state.score>state.high){state.high=state.score;localStorage.setItem('el_high',String(state.high))}
  document.getElementById('highScore').textContent=state.high;
  document.getElementById('bestScore').textContent=state.high;
  alert((state.lang==='th'?'จบการทดสอบ คะแนน':'Test finished. Score')+': '+state.score);
  state.view='learn';
  renderView();
}

function flash(ok){
  const el=document.querySelector('#testArea .problem-card');
  if(!el)return;
  el.style.transition='box-shadow .2s,transform .2s';
  if(ok){el.style.boxShadow='0 20px 60px rgba(0,200,120,0.14)';el.style.transform='translateY(-6px)';setTimeout(()=>{el.style.boxShadow='';el.style.transform=''},220)}else{el.style.boxShadow='0 20px 60px rgba(200,50,50,0.12)';setTimeout(()=>{el.style.boxShadow=''},220)}}

function validateAnswer(q,ans){
  if(!ans) return false;
  const id=q.id;
  const num=Number(ans);
  switch(id){
    case 1:{
      const a=-1;
      if(Math.abs(num-a)<1e-6) return true;
      const expr=ans.replace(/\s+/g,'');
      if(expr==='-1') return true;
      return false
    }
    case 2:{
      if(Math.abs(num-2)<1e-6) return true;
      return false
    }
    case 3:{
      const arr=[];
      const x1=1; const x2=5;
      if(Math.abs(num-x1)<1e-6||Math.abs(num-x2)<1e-6) return true;
      return false
    }
    case 4:{
      const sol=['3','(3,\\infty)'];if(sol.includes(ans))return true;return false
    }
    case 5:{
      const interval=['1','2']; return false
    }
    case 6:return ans.toLowerCase().includes('shift')||ans.toLowerCase().includes('move')
    case 7:return false
    case 8:return (Math.abs(num-2)<1e-6||ans==='2')
    case 9:return (Math.abs(num-5)<1e-6||ans==='5')
    case 10:return false
    case 11:return (Math.abs(num-0.5)<1e-6||ans==='1/2'||ans==='0.5')
    case 12:return (Math.abs(num-1.5)<1e-6||ans==='3/2')
    case 13:return false
    case 14:return false
    case 15:return false
    case 16:return false
    case 17:return (Math.abs(num-1/9)<1e-6||ans==='1/9')
    case 18:return false
    case 19:return false
    case 20:return false
    case 21:return false
    case 22:return ans.replace(/\s+/g,'')==='1'
    case 23:return false
    case 24:return false
    case 25:return false
    case 26:return (Math.abs(num-10)<1e-6||ans==='10')
    case 27:return false
    case 28:return (Math.abs(num-0)<1e-6||ans==='0')
    case 29: {
      const sol=8;
      if(Math.abs(num-sol)<1e-6) return true;
      return false
    }
    case 30: {
      const sol=4;
      if(Math.abs(num-sol)<1e-6) return true;
      return false
    }
    default:return false
  }
}

function pickRandom(arr,n){const pool=arr.slice();const sel=[];for(let i=0;i<n&&pool.length;i++){const idx=Math.floor(Math.random()*pool.length);sel.push(pool.splice(idx,1)[0])}return sel}
function shuffleArray(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

function startTestTimer(seconds){
  stopTestTimer();
  let s=seconds;
  document.getElementById('testTimer').textContent=formatTime(s);
  state.testTimer=setInterval(()=>{s--;document.getElementById('testTimer').textContent=formatTime(s);if(s<=0){clearInterval(state.testTimer);alert((state.lang==='th'?'เวลาหมด':'Time up')+': '+state.score);endTest()}},1000)
}
function stopTestTimer(){if(state.testTimer){clearInterval(state.testTimer);state.testTimer=null}}

function updateProgress(){const completed=state.index+1;document.getElementById('progressVal').textContent=completed+' / '+problems.length;const pct=Math.round((completed/problems.length)*100);document.getElementById('progressInner').style.width=pct+'%'}
function truncate(s,n){if(s.length<=n)return s;return s.slice(0,n-2)+'...'}

function init(){
  renderAll();
  bindUI();
  renderBank();
  document.getElementById('highScore').textContent=state.high;
  document.getElementById('progressVal').textContent='0 / '+problems.length;
  populateInitial();
  setInterval(()=>{const sec=Math.floor((Date.now()-state.globalStart)/1000);document.getElementById('globalTimer').textContent=formatTime(sec)},1000);
}

function populateInitial(){
  renderLearnBoard();
  openProblem(problems[0].id);
}

init();
</script>
</body>
</html>
